<!doctype html>
<html>
<head>
    <title>Performance Counters</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="bootstrap.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="bootstrap-responsive.css" rel="stylesheet">
    <link href="rickshaw.min.css" rel="stylesheet" />
    <link href="d3.css" rel="stylesheet" />
</head>
<body>
    <div id="wrapper">
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="brand" href="#">Performance Counters</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active">
                                <a id="Application" href="#">Application</a>
                            </li>
                            <li>
                                <a id="System" href="#">System</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <h1>Under Construction</h1>
            <div id="placeholder"></div>
        </div>

    </div>

    <div class="error" style="display: none"></div>
    <div id="push"></div>
    
    <div id="footer">
        <div class="container">
            <div class="muted credit">
                <p>2013 (c) <a href="http://github.com/DmitryNaumov">Dmitry Naumov</a></p>
            </div>
        </div>
    </div>

    <script src="bootstrap.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.0.1/d3.v3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/rickshaw/1.1.0/rickshaw.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="charts.js"></script>

    <script>
        $(function () {
            var categoryName = {};
            
            $("#Application").click(function() {
                categoryName = "Application";
            });

            $("#System").click(function () {
                categoryName = "System";
            });

            $.ajax("/api/stats/GetCounters", {
                headers: {
                    Accept: "application/json"
                },
                success: success,
                error: error
            });

            function success(metadata) {
                setupCharts(metadata);
                poll();
            }

            function error(xhr, status, err) {
                $(".error").text(xhr.statusText).show();
            }

            function setupCharts(counters) {
                for (var i in counters) {
                    var counterName = counters[i].Name;
                    window.Charts(i, counterName);
                }
            }

            function poll() {
                setTimeout(function() {
                    poll();
                }, 1000);

                $.ajax("/api/stats/GetCounterData", {
                    headers: {
                        Accept: "application/json"
                    },
                    success: success,
                    error: error
                });

                function success(data) {
                    $(".error").hide();
                    $(document).trigger("sample.updateEvent", [data]);
                }

                function error(xhr, status, err) {
                }
            }
        });

    </script>
</body>
</html>
